<!DOCTYPE html>
<html lang="en" data-theme="neon-purple" data-font="chakra">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Open Z ‚Äî AI Intelligence Redefined</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@400;500;600;700&family=Michroma&family=Audiowide&family=Kanit:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">

<style>
/* ============================================================
   FONT SYSTEM ‚Äî 3 combos selectable by user
   [data-font="chakra"]  ‚Üí Chakra Petch + JetBrains Mono
   [data-font="michroma"] ‚Üí Michroma + Fira Code
   [data-font="kanit"]   ‚Üí Kanit + JetBrains Mono
   ============================================================ */
[data-font="chakra"]  { --fd: 'Chakra Petch', sans-serif; --fb: 'JetBrains Mono', monospace; }
[data-font="michroma"]{ --fd: 'Michroma', sans-serif;     --fb: 'Fira Code', monospace; }
[data-font="kanit"]   { --fd: 'Kanit', sans-serif;        --fb: 'JetBrains Mono', monospace; }

/* ============================================================
   BASE RESET
   ============================================================ */
*, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }

/* ============================================================
   THEME SYSTEM ‚Äî 8 Themes
   ============================================================ */
:root {
  --a1:#b347ff; --a2:#7c3aed; --a3:#e040fb;
  --g1:rgba(179,71,255,0.55); --g2:rgba(179,71,255,0.18); --g3:rgba(179,71,255,0.07);
  --bg1:#080010; --bg2:#0c0018; --bg3:#120022;
  --gl:rgba(18,0,38,0.7); --gl2:rgba(28,0,55,0.5); --gl3:rgba(40,0,70,0.3);
  --tx1:#f2e8ff; --tx2:#c8aaee; --tx3:#7a5a9a;
  --bd1:rgba(179,71,255,0.3); --bd2:rgba(179,71,255,0.12);
  --ub:linear-gradient(135deg,#7c3aed,#b347ff);
  --ab:rgba(16,0,36,0.85);
  --sb-w:290px;
  --ease:cubic-bezier(0.4,0,0.2,1);
  --spring:cubic-bezier(0.16,1,0.3,1);
}
[data-theme="electric-blue"]{
  --a1:#00b4ff;--a2:#0055cc;--a3:#44ddff;
  --g1:rgba(0,180,255,0.55);--g2:rgba(0,180,255,0.18);--g3:rgba(0,180,255,0.07);
  --bg1:#00080f;--bg2:#000d18;--bg3:#001220;
  --gl:rgba(0,18,45,0.7);--gl2:rgba(0,28,65,0.5);--gl3:rgba(0,40,80,0.3);
  --tx1:#e0f5ff;--tx2:#88cce8;--tx3:#3a6878;
  --bd1:rgba(0,180,255,0.3);--bd2:rgba(0,180,255,0.12);
  --ub:linear-gradient(135deg,#0055cc,#00b4ff);--ab:rgba(0,18,45,0.85);
}
[data-theme="cyber-green"]{
  --a1:#00ff88;--a2:#00bb55;--a3:#55ffaa;
  --g1:rgba(0,255,136,0.55);--g2:rgba(0,255,136,0.18);--g3:rgba(0,255,136,0.07);
  --bg1:#000e05;--bg2:#001208;--bg3:#001a0c;
  --gl:rgba(0,20,10,0.7);--gl2:rgba(0,32,16,0.5);--gl3:rgba(0,45,22,0.3);
  --tx1:#e0fff2;--tx2:#77ddaa;--tx3:#338855;
  --bd1:rgba(0,255,136,0.3);--bd2:rgba(0,255,136,0.12);
  --ub:linear-gradient(135deg,#00bb55,#00ff88);--ab:rgba(0,20,10,0.85);
}
[data-theme="crimson-red"]{
  --a1:#ff2244;--a2:#bb0022;--a3:#ff6677;
  --g1:rgba(255,34,68,0.55);--g2:rgba(255,34,68,0.18);--g3:rgba(255,34,68,0.07);
  --bg1:#130004;--bg2:#180006;--bg3:#1e000a;
  --gl:rgba(32,0,10,0.7);--gl2:rgba(48,0,16,0.5);--gl3:rgba(62,0,22,0.3);
  --tx1:#ffe0e5;--tx2:#dd8899;--tx3:#884455;
  --bd1:rgba(255,34,68,0.3);--bd2:rgba(255,34,68,0.12);
  --ub:linear-gradient(135deg,#bb0022,#ff2244);--ab:rgba(32,0,10,0.85);
}
[data-theme="sunset-orange"]{
  --a1:#ff6600;--a2:#cc3300;--a3:#ff9933;
  --g1:rgba(255,102,0,0.55);--g2:rgba(255,102,0,0.18);--g3:rgba(255,102,0,0.07);
  --bg1:#130700;--bg2:#180a00;--bg3:#1e0f00;
  --gl:rgba(34,14,0,0.7);--gl2:rgba(50,20,0,0.5);--gl3:rgba(65,28,0,0.3);
  --tx1:#fff0e0;--tx2:#ddaa66;--tx3:#885522;
  --bd1:rgba(255,102,0,0.3);--bd2:rgba(255,102,0,0.12);
  --ub:linear-gradient(135deg,#cc3300,#ff6600);--ab:rgba(34,14,0,0.85);
}
[data-theme="royal-gold"]{
  --a1:#ffd700;--a2:#cc9900;--a3:#ffe566;
  --g1:rgba(255,215,0,0.55);--g2:rgba(255,215,0,0.18);--g3:rgba(255,215,0,0.07);
  --bg1:#0f0c00;--bg2:#141000;--bg3:#1a1500;
  --gl:rgba(28,22,0,0.7);--gl2:rgba(42,33,0,0.5);--gl3:rgba(56,44,0,0.3);
  --tx1:#fffae0;--tx2:#ddcc66;--tx3:#887722;
  --bd1:rgba(255,215,0,0.3);--bd2:rgba(255,215,0,0.12);
  --ub:linear-gradient(135deg,#cc9900,#ffd700);--ab:rgba(28,22,0,0.85);
}
[data-theme="midnight-cyan"]{
  --a1:#00ffee;--a2:#00aacc;--a3:#66ffee;
  --g1:rgba(0,255,238,0.55);--g2:rgba(0,255,238,0.18);--g3:rgba(0,255,238,0.07);
  --bg1:#000f0e;--bg2:#001312;--bg3:#001918;
  --gl:rgba(0,22,20,0.7);--gl2:rgba(0,33,30,0.5);--gl3:rgba(0,45,40,0.3);
  --tx1:#e0fffc;--tx2:#66ddcc;--tx3:#228877;
  --bd1:rgba(0,255,238,0.3);--bd2:rgba(0,255,238,0.12);
  --ub:linear-gradient(135deg,#00aacc,#00ffee);--ab:rgba(0,22,20,0.85);
}
[data-theme="soft-pink"]{
  --a1:#ff55bb;--a2:#cc2288;--a3:#ff88cc;
  --g1:rgba(255,85,187,0.55);--g2:rgba(255,85,187,0.18);--g3:rgba(255,85,187,0.07);
  --bg1:#130010;--bg2:#180014;--bg3:#1e001a;
  --gl:rgba(34,0,28,0.7);--gl2:rgba(50,0,42,0.5);--gl3:rgba(65,0,55,0.3);
  --tx1:#ffe0f5;--tx2:#dd88bb;--tx3:#884466;
  --bd1:rgba(255,85,187,0.3);--bd2:rgba(255,85,187,0.12);
  --ub:linear-gradient(135deg,#cc2288,#ff55bb);--ab:rgba(34,0,28,0.85);
}

/* ============================================================
   ANIMATIONS
   ============================================================ */
@keyframes pageIn    { from{opacity:0;transform:scale(0.97)}to{opacity:1;transform:scale(1)} }
@keyframes orb1      { 0%,100%{transform:translate(0,0)}33%{transform:translate(70px,-50px)}66%{transform:translate(-50px,70px)} }
@keyframes orb2      { 0%,100%{transform:translate(0,0)}33%{transform:translate(-80px,60px)}66%{transform:translate(60px,-70px)} }
@keyframes orb3      { 0%,100%{transform:translate(-50%,-50%)}50%{transform:translate(calc(-50% + 45px),calc(-50% + 35px))} }
@keyframes glowPulse { 0%,100%{box-shadow:0 0 18px var(--g1),0 0 35px var(--g2)}50%{box-shadow:0 0 35px var(--g1),0 0 70px var(--g2)} }
@keyframes inputGlow { 0%,100%{box-shadow:0 0 10px var(--g2)}50%{box-shadow:0 0 22px var(--g2),0 0 45px var(--g3)} }
@keyframes bounce    { 0%,80%,100%{transform:translateY(0);opacity:0.35}40%{transform:translateY(-9px);opacity:1} }
@keyframes slideR    { from{opacity:0;transform:translateX(26px) scale(0.96)}to{opacity:1;transform:translateX(0) scale(1)} }
@keyframes slideL    { from{opacity:0;transform:translateX(-26px) scale(0.96)}to{opacity:1;transform:translateX(0) scale(1)} }
@keyframes fadeUp    { from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)} }
@keyframes rippleOut { to{transform:scale(5);opacity:0} }
@keyframes spin      { to{transform:rotate(360deg)} }
@keyframes gradShift { 0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%} }
@keyframes floatY    { 0%,100%{transform:translateY(-50%)}50%{transform:translateY(calc(-50% - 7px))} }
@keyframes ringCW    { to{transform:rotate(360deg)} }
@keyframes ringCCW   { to{transform:rotate(-360deg)} }
@keyframes logoPulse { 0%,100%{filter:drop-shadow(0 0 6px var(--a1)) drop-shadow(0 0 14px var(--g2))}50%{filter:drop-shadow(0 0 16px var(--a1)) drop-shadow(0 0 32px var(--g1))} }
@keyframes blink     { 0%,100%{opacity:1}50%{opacity:0} }
@keyframes sbSlideIn { from{transform:translateX(-100%)}to{transform:translateX(0)} }
@keyframes sbSlideOut{ from{transform:translateX(0)}to{transform:translateX(-100%)} }
@keyframes pillIn    { from{opacity:0;transform:translateY(14px)}to{opacity:1;transform:translateY(0)} }

/* ============================================================
   BODY & LAYOUT
   ============================================================ */
html,body{
  height:100%; font-family:var(--fb);
  background:var(--bg1); color:var(--tx1);
  overflow:hidden;
  transition:background 0.5s var(--ease),color 0.3s var(--ease);
}
body{ animation:pageIn 0.8s var(--spring) both; }

/* Orbs */
.orb{position:fixed;border-radius:50%;filter:blur(90px);pointer-events:none;z-index:0;transition:background 0.6s;}
.orb-1{width:620px;height:620px;background:var(--a1);top:-200px;left:-200px;opacity:0.2;animation:orb1 22s ease-in-out infinite;}
.orb-2{width:520px;height:520px;background:var(--a2);bottom:-170px;right:-170px;opacity:0.16;animation:orb2 27s ease-in-out infinite;}
.orb-3{width:340px;height:340px;background:var(--a3);top:50%;left:50%;transform:translate(-50%,-50%);opacity:0.11;animation:orb3 17s ease-in-out infinite;}

/* Mouse glow */
#mouse-glow{
  position:fixed;width:340px;height:340px;border-radius:50%;
  background:radial-gradient(circle,var(--g2) 0%,transparent 65%);
  pointer-events:none;z-index:1;transform:translate(-50%,-50%);
  transition:left 0.07s linear,top 0.07s linear,background 0.4s;
}

/* App shell */
#app{
  position:relative;z-index:2;height:100vh;
  display:flex;flex-direction:column;
  transition:padding-left 0.4s var(--spring);
}
#app.sb-open{ padding-left:var(--sb-w); }

/* ============================================================
   SIDEBAR
   ============================================================ */
#sidebar{
  position:fixed;left:0;top:0;bottom:0;
  width:var(--sb-w);
  background:var(--gl);
  backdrop-filter:blur(28px) saturate(180%);
  border-right:1px solid var(--bd1);
  z-index:300;
  display:flex;flex-direction:column;
  transform:translateX(-100%);
  transition:transform 0.4s var(--spring);
  box-shadow:4px 0 40px rgba(0,0,0,0.5);
}
#sidebar.open{ transform:translateX(0); }

/* Sidebar header */
.sb-head{
  padding:20px 20px 16px;
  border-bottom:1px solid var(--bd2);
  display:flex;align-items:center;justify-content:space-between;
}
.sb-title{
  font-family:var(--fd);
  font-size:0.7rem;font-weight:700;
  letter-spacing:0.22em;text-transform:uppercase;
  color:var(--tx3);
}
.sb-close{
  width:28px;height:28px;border-radius:50%;
  background:var(--gl2);border:1px solid var(--bd1);
  color:var(--tx2);cursor:pointer;font-size:0.8rem;
  display:flex;align-items:center;justify-content:center;
  transition:all 0.2s;
}
.sb-close:hover{border-color:var(--a1);color:var(--a1);}

/* Sidebar menu items */
.sb-menu{ padding:12px 12px; display:flex;flex-direction:column;gap:4px; }
.sb-item{
  display:flex;align-items:center;gap:12px;
  padding:11px 14px;border-radius:12px;
  cursor:pointer;font-size:0.82rem;font-weight:600;
  color:var(--tx2);font-family:var(--fd);
  transition:all 0.2s var(--ease);
  border:1px solid transparent;
  position:relative;overflow:hidden;
}
.sb-item:hover{
  background:var(--gl2);border-color:var(--bd1);
  color:var(--a1);transform:translateX(4px);
}
.sb-item .sb-ic{font-size:1.1rem;width:22px;text-align:center;flex-shrink:0;}
.sb-item.danger:hover{color:#ff4466;border-color:rgba(255,68,102,0.3);}

/* Chat history list */
.sb-section-label{
  padding:10px 14px 4px;
  font-size:0.58rem;font-family:'JetBrains Mono',monospace;
  color:var(--tx3);letter-spacing:0.22em;text-transform:uppercase;
}
#history-list{
  flex:1;overflow-y:auto;padding:4px 12px;
}
#history-list::-webkit-scrollbar{width:3px;}
#history-list::-webkit-scrollbar-thumb{background:var(--bd1);border-radius:99px;}
.hist-item{
  padding:9px 12px;border-radius:10px;cursor:pointer;
  font-size:0.75rem;color:var(--tx2);font-family:var(--fd);
  border:1px solid transparent;
  transition:all 0.2s;
  white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
  margin-bottom:3px;
}
.hist-item:hover{background:var(--gl2);border-color:var(--bd2);color:var(--a1);}
.hist-item.active{background:var(--gl2);border-color:var(--bd1);color:var(--a1);}

/* Font selector at bottom of sidebar */
.sb-fonts{
  padding:12px;border-top:1px solid var(--bd2);
}
.font-combo-row{display:flex;gap:6px;margin-top:8px;}
.font-chip{
  flex:1;padding:7px 6px;border-radius:10px;text-align:center;
  font-size:0.62rem;cursor:pointer;
  background:var(--gl2);border:1px solid var(--bd2);
  color:var(--tx3);transition:all 0.2s;white-space:nowrap;
  overflow:hidden;text-overflow:ellipsis;
}
.font-chip:hover{border-color:var(--bd1);color:var(--tx2);}
.font-chip.active{border-color:var(--a1);color:var(--a1);background:var(--g3);}

/* ============================================================
   HEADER
   ============================================================ */
#header{
  display:flex;align-items:center;justify-content:space-between;
  padding:12px 18px;
  background:var(--gl);
  backdrop-filter:blur(28px) saturate(180%);
  -webkit-backdrop-filter:blur(28px) saturate(180%);
  border-bottom:1px solid var(--bd1);
  box-shadow:0 2px 30px var(--g3),inset 0 1px 0 rgba(255,255,255,0.03);
  flex-shrink:0;gap:10px;
  transition:background 0.5s,border-color 0.5s;
  position:relative;z-index:10;
}

/* Hamburger */
#sb-toggle{
  width:36px;height:36px;border-radius:10px;
  background:var(--gl2);border:1px solid var(--bd1);
  color:var(--tx2);cursor:pointer;font-size:1rem;
  display:flex;align-items:center;justify-content:center;
  transition:all 0.2s;flex-shrink:0;
}
#sb-toggle:hover{border-color:var(--a1);color:var(--a1);box-shadow:0 0 14px var(--g2);}

/* Logo */
#logo-wrap{display:flex;align-items:center;gap:11px;text-decoration:none;cursor:pointer;}
#logo-svg{width:42px;height:42px;flex-shrink:0;animation:logoPulse 3s ease-in-out infinite;}
#logo-text{
  font-family:var(--fd);font-size:1.2rem;font-weight:700;
  letter-spacing:0.16em;text-transform:uppercase;
  background:linear-gradient(135deg,var(--a1),var(--a3));
  background-size:200% 200%;animation:gradShift 5s ease infinite;
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
  transition:background 0.5s;
}
#logo-sub{
  font-size:0.5rem;font-family:'JetBrains Mono',monospace;
  color:var(--tx3);letter-spacing:0.3em;text-transform:uppercase;margin-top:2px;
}

/* Header right */
#hdr-right{display:flex;align-items:center;gap:8px;}

/* Model selector */
#model-wrap{position:relative;}
#model-btn{
  display:flex;align-items:center;gap:7px;
  padding:7px 13px;
  background:var(--gl2);border:1px solid var(--bd1);
  border-radius:99px;color:var(--tx1);
  font-family:var(--fd);font-size:0.72rem;font-weight:600;
  cursor:pointer;white-space:nowrap;
  transition:all 0.25s var(--ease);
}
#model-btn:hover{border-color:var(--a1);box-shadow:0 0 16px var(--g2);}
#model-btn .chev{font-size:0.55rem;opacity:0.6;transition:transform 0.2s;}
#model-btn.open .chev{transform:rotate(180deg);}
#model-dd{
  position:absolute;top:calc(100% + 8px);right:0;min-width:260px;
  background:var(--bg2);border:1px solid var(--bd1);
  border-radius:16px;overflow:hidden;
  backdrop-filter:blur(24px);
  box-shadow:0 20px 55px rgba(0,0,0,0.6),0 0 35px var(--g3);
  opacity:0;transform:translateY(-10px) scale(0.96);
  pointer-events:none;transition:opacity 0.25s,transform 0.25s var(--spring);
  z-index:200;
}
#model-dd.open{opacity:1;transform:translateY(0) scale(1);pointer-events:all;}
.model-group-label{
  padding:10px 16px 5px;
  font-size:0.58rem;font-family:'JetBrains Mono',monospace;
  color:var(--tx3);letter-spacing:0.2em;text-transform:uppercase;
}
.mdi{
  display:flex;align-items:center;justify-content:space-between;
  padding:9px 16px;cursor:pointer;font-size:0.78rem;font-weight:600;
  color:var(--tx2);font-family:var(--fd);
  transition:background 0.15s,color 0.15s,padding-left 0.15s;
  border-bottom:1px solid var(--bd2);gap:10px;
}
.mdi:last-child{border-bottom:none;}
.mdi:hover,.mdi.active{background:var(--g3);color:var(--a1);padding-left:20px;}
.mdi-badge{
  font-size:0.55rem;font-family:'JetBrains Mono',monospace;
  padding:2px 7px;border-radius:99px;
  background:var(--g3);border:1px solid var(--bd1);
  color:var(--tx3);white-space:nowrap;flex-shrink:0;
}
.mdi-badge.fast{color:#00ff88;border-color:rgba(0,255,136,0.3);}
.mdi-badge.smart{color:#b347ff;border-color:rgba(179,71,255,0.3);}
.mdi-badge.beast{color:#ff6600;border-color:rgba(255,102,0,0.3);}

/* Mode selector */
#mode-wrap{position:relative;}
#mode-btn{
  display:flex;align-items:center;gap:7px;padding:7px 13px;
  background:var(--gl2);border:1px solid var(--bd1);
  border-radius:99px;color:var(--tx1);
  font-family:var(--fd);font-size:0.72rem;font-weight:600;
  cursor:pointer;white-space:nowrap;transition:all 0.25s;
}
#mode-btn:hover{border-color:var(--a1);box-shadow:0 0 16px var(--g2);}
#mode-btn .chev2{font-size:0.55rem;opacity:0.6;transition:transform 0.2s;}
#mode-btn.open .chev2{transform:rotate(180deg);}
#mode-dd{
  position:absolute;top:calc(100% + 8px);right:0;min-width:220px;
  background:var(--bg2);border:1px solid var(--bd1);
  border-radius:16px;overflow:hidden;backdrop-filter:blur(24px);
  box-shadow:0 20px 55px rgba(0,0,0,0.6),0 0 35px var(--g3);
  opacity:0;transform:translateY(-10px) scale(0.96);pointer-events:none;
  transition:opacity 0.25s,transform 0.25s var(--spring);z-index:200;
}
#mode-dd.open{opacity:1;transform:translateY(0) scale(1);pointer-events:all;}
.mdei{
  display:flex;align-items:center;gap:11px;padding:10px 16px;
  cursor:pointer;font-size:0.78rem;font-weight:600;
  color:var(--tx2);font-family:var(--fd);
  border-bottom:1px solid var(--bd2);
  transition:background 0.15s,color 0.15s,padding-left 0.15s;
}
.mdei:last-child{border-bottom:none;}
.mdei:hover,.mdei.active{background:var(--g3);color:var(--a1);padding-left:20px;}
.mdei-ic{font-size:1rem;width:20px;text-align:center;}

/* Icon buttons */
.ic-btn{
  width:36px;height:36px;border-radius:10px;
  background:var(--gl2);border:1px solid var(--bd1);
  color:var(--tx2);cursor:pointer;font-size:0.95rem;
  display:flex;align-items:center;justify-content:center;
  transition:all 0.2s;position:relative;overflow:hidden;
}
.ic-btn:hover{border-color:var(--a1);color:var(--a1);box-shadow:0 0 14px var(--g2);transform:scale(1.08);}

/* ============================================================
   THEME SWITCHER (floating)
   ============================================================ */
#theme-panel{
  position:fixed;right:14px;top:50%;transform:translateY(-50%);
  z-index:50;display:flex;flex-direction:column;align-items:center;gap:6px;
  animation:floatY 3.5s ease-in-out infinite;
}
#theme-toggle{
  width:34px;height:34px;border-radius:50%;
  background:var(--gl2);border:1px solid var(--bd1);
  color:var(--tx2);cursor:pointer;font-size:0.95rem;
  display:flex;align-items:center;justify-content:center;
  margin-bottom:4px;transition:all 0.25s;
  box-shadow:0 0 16px var(--g3);
  position:relative;overflow:hidden;
}
#theme-toggle:hover{border-color:var(--a1);box-shadow:0 0 22px var(--g1);}
.swatch{
  width:26px;height:26px;border-radius:50%;cursor:pointer;
  border:2.5px solid transparent;display:none;flex-shrink:0;
  transition:all 0.25s var(--spring);
}
.swatch.vis{display:block;}
.swatch:hover{transform:scale(1.12);}
.swatch.active{border-color:#fff;transform:scale(1.22);box-shadow:0 0 12px rgba(255,255,255,0.35);}
.swatch[data-t="neon-purple"]  {background:#b347ff;}
.swatch[data-t="electric-blue"]{background:#00b4ff;}
.swatch[data-t="cyber-green"]  {background:#00ff88;}
.swatch[data-t="crimson-red"]  {background:#ff2244;}
.swatch[data-t="sunset-orange"]{background:#ff6600;}
.swatch[data-t="royal-gold"]   {background:#ffd700;}
.swatch[data-t="midnight-cyan"]{background:#00ffee;}
.swatch[data-t="soft-pink"]    {background:#ff55bb;}

/* ============================================================
   CHAT AREA
   ============================================================ */
#chat-area{
  flex:1;overflow-y:auto;
  padding:24px 18px;
  display:flex;flex-direction:column;gap:16px;
  scroll-behavior:smooth;
}
#chat-area::-webkit-scrollbar{width:3px;}
#chat-area::-webkit-scrollbar-thumb{background:var(--bd1);border-radius:99px;}

/* Welcome */
#welcome{
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  flex:1;text-align:center;padding:30px 20px;
  animation:fadeUp 0.9s var(--spring) both;
}
#welcome-logo-svg{
  width:96px;height:96px;margin-bottom:24px;
  animation:logoPulse 2.8s ease-in-out infinite;
  filter:drop-shadow(0 0 20px var(--a1)) drop-shadow(0 0 40px var(--g2));
}
#wtitle{
  font-family:var(--fd);font-size:clamp(1.4rem,3.5vw,2.2rem);font-weight:700;
  letter-spacing:0.06em;
  background:linear-gradient(135deg,var(--a1),var(--a3),var(--a2));
  background-size:200%;animation:gradShift 4s ease infinite;
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
  margin-bottom:10px;min-height:2.6rem;
}
#wtitle::after{
  content:'|';-webkit-text-fill-color:var(--a1);
  animation:blink 0.85s step-end infinite;font-weight:300;
}
#wsub{
  color:var(--tx3);font-size:0.85rem;max-width:380px;
  line-height:1.7;margin-bottom:26px;font-family:'JetBrains Mono',monospace;
}
#wpills{display:flex;flex-wrap:wrap;gap:8px;justify-content:center;}
.wpill{
  padding:5px 14px;border-radius:99px;
  border:1px solid var(--bd1);font-size:0.68rem;
  color:var(--tx3);font-family:'JetBrains Mono',monospace;
  background:var(--gl2);
  animation:pillIn 0.7s var(--spring) both;
  transition:all 0.2s;cursor:default;
}
.wpill:hover{border-color:var(--a1);color:var(--a1);transform:translateY(-2px);}
.wpill:nth-child(2){animation-delay:0.07s;}
.wpill:nth-child(3){animation-delay:0.14s;}
.wpill:nth-child(4){animation-delay:0.21s;}
.wpill:nth-child(5){animation-delay:0.28s;}

/* Messages */
.msg-row{display:flex;align-items:flex-end;gap:10px;max-width:800px;width:100%;}
.msg-row.user{flex-direction:row-reverse;margin-left:auto;animation:slideR 0.36s var(--spring);}
.msg-row.ai{margin-right:auto;animation:slideL 0.36s var(--spring);}
.ava{
  width:32px;height:32px;border-radius:50%;flex-shrink:0;
  display:flex;align-items:center;justify-content:center;
  font-size:0.85rem;border:1px solid var(--bd1);
}
.ava.ai{background:var(--gl2);box-shadow:0 0 10px var(--g2);font-size:0.9rem;}
.ava.usr{background:var(--ub);box-shadow:0 0 10px var(--g2);}
.bub{
  padding:12px 17px;border-radius:18px;
  font-size:0.86rem;line-height:1.68;
  max-width:560px;position:relative;word-break:break-word;
  font-family:var(--fb);
}
.bub.usr{
  background:var(--ub);color:#fff;
  border-bottom-right-radius:4px;
  box-shadow:0 5px 22px var(--g2);
  transition:background 0.5s,box-shadow 0.4s;
}
.bub.ai{
  background:var(--ab);border:1px solid var(--bd1);
  color:var(--tx1);border-bottom-left-radius:4px;
  backdrop-filter:blur(16px);
  box-shadow:0 5px 22px rgba(0,0,0,0.28);
  transition:background 0.5s,border-color 0.5s;
}
.bub-acts{display:flex;gap:5px;margin-top:8px;opacity:0;transition:opacity 0.2s;}
.msg-row:hover .bub-acts{opacity:1;}
.act-btn{
  display:flex;align-items:center;gap:3px;
  padding:3px 9px;border-radius:99px;
  background:var(--gl2);border:1px solid var(--bd1);
  color:var(--tx3);font-size:0.63rem;
  font-family:'JetBrains Mono',monospace;cursor:pointer;
  transition:all 0.15s;
}
.act-btn:hover{border-color:var(--a1);color:var(--a1);}
.bub pre,.bub code{
  font-family:'JetBrains Mono',monospace;
  background:rgba(0,0,0,0.4);border:1px solid var(--bd2);
  border-radius:8px;padding:2px 7px;font-size:0.78em;color:var(--a3);
}
.bub pre{padding:12px;overflow-x:auto;margin:8px 0;display:block;}
.bub pre code{background:none;border:none;padding:0;}

/* Typing */
#typing-row{display:none;align-items:flex-end;gap:10px;animation:slideL 0.3s var(--spring);}
#typing-row.show{display:flex;}
.typing-bub{
  display:flex;gap:6px;align-items:center;
  padding:13px 18px;background:var(--ab);
  border:1px solid var(--bd1);border-radius:18px;border-bottom-left-radius:4px;
}
.dot{
  width:7px;height:7px;border-radius:50%;
  background:var(--a1);transition:background 0.5s;
  animation:bounce 1.5s ease-in-out infinite;
}
.dot:nth-child(2){animation-delay:0.18s;}
.dot:nth-child(3){animation-delay:0.36s;}

/* ============================================================
   INPUT BAR
   ============================================================ */
#input-area{
  padding:12px 18px 0;
  background:var(--gl);
  backdrop-filter:blur(24px);
  border-top:1px solid var(--bd1);
  flex-shrink:0;
  transition:background 0.5s,border-color 0.5s;
}
#input-wrap{
  max-width:800px;margin:0 auto;
  display:flex;align-items:flex-end;gap:8px;
  background:var(--gl2);border:1px solid var(--bd1);
  border-radius:20px;padding:9px 9px 9px 16px;
  transition:border-color 0.25s,box-shadow 0.25s,background 0.5s;
  animation:inputGlow 3.5s ease-in-out infinite;
}
#input-wrap:focus-within{
  border-color:var(--a1);
  box-shadow:0 0 22px var(--g2),0 0 55px var(--g3);
  animation:none;
}
#chat-input{
  flex:1;background:transparent;border:none;outline:none;
  color:var(--tx1);font-family:var(--fb);font-size:0.86rem;
  resize:none;line-height:1.55;max-height:130px;padding:2px 0;
  transition:color 0.5s;
}
#chat-input::placeholder{color:var(--tx3);}
#send-btn{
  width:40px;height:40px;border-radius:14px;
  background:linear-gradient(135deg,var(--a2),var(--a1));
  border:none;color:#fff;cursor:pointer;flex-shrink:0;
  display:flex;align-items:center;justify-content:center;
  font-size:1rem;
  transition:transform 0.25s var(--spring),box-shadow 0.25s,background 0.5s;
  position:relative;overflow:hidden;
  animation:glowPulse 2.5s ease-in-out infinite;
}
#send-btn:hover:not(:disabled){
  transform:scale(1.1) rotate(4deg);animation:none;
  box-shadow:0 0 28px var(--g1),0 0 55px var(--g2);
}
#send-btn:disabled{opacity:0.35;cursor:not-allowed;animation:none;}
.send-ic{transition:opacity 0.15s;}
.spin-ic{
  width:17px;height:17px;border-radius:50%;
  border:2.5px solid rgba(255,255,255,0.28);border-top-color:#fff;
  animation:spin 0.65s linear infinite;display:none;
}
#send-btn.loading .send-ic{display:none;}
#send-btn.loading .spin-ic{display:block;}

/* ============================================================
   FOOTER
   ============================================================ */
#footer{
  text-align:center;padding:8px 0 10px;
  font-size:0.6rem;font-family:'JetBrains Mono',monospace;
  color:var(--tx3);letter-spacing:0.1em;
  background:var(--gl);border-top:1px solid var(--bd2);
  flex-shrink:0;display:flex;align-items:center;justify-content:center;gap:6px;
  transition:background 0.5s,border-color 0.5s;
}
#tg-link{
  display:inline-flex;align-items:center;gap:5px;
  color:var(--a1);text-decoration:none;font-weight:600;
  transition:all 0.2s;padding:2px 8px;border-radius:99px;
  border:1px solid transparent;
}
#tg-link:hover{
  border-color:var(--bd1);
  background:var(--g3);
  box-shadow:0 0 10px var(--g2);
}
.tg-logo{
  width:14px;height:14px;border-radius:50%;
  background:linear-gradient(135deg,#2AABEE,#229ED9);
  display:inline-flex;align-items:center;justify-content:center;
  font-size:0.55rem;color:#fff;flex-shrink:0;
}

/* ============================================================
   RIPPLE
   ============================================================ */
.rip{position:relative;overflow:hidden;}
.rip-el{
  position:absolute;border-radius:50%;
  background:rgba(255,255,255,0.2);
  transform:scale(0);pointer-events:none;
  animation:rippleOut 0.65s ease-out forwards;
}

/* ============================================================
   SIDEBAR OVERLAY (mobile)
   ============================================================ */
#sb-overlay{
  display:none;position:fixed;inset:0;
  background:rgba(0,0,0,0.5);z-index:290;
  backdrop-filter:blur(4px);
}
#sb-overlay.show{display:block;}

/* ============================================================
   RESPONSIVE
   ============================================================ */
@media(max-width:640px){
  #app.sb-open{padding-left:0;}
  #sb-overlay.show{display:block;}
  #logo-sub{display:none;}
  #logo-text{font-size:1rem;}
  .bub{max-width:calc(100vw - 90px);}
  #hdr-right{gap:5px;}
  .model-label{display:none;}
  .mode-label{display:none;}
  #theme-panel{right:6px;}
  .swatch{width:22px;height:22px;}
}
@media(max-width:400px){
  #model-btn{padding:6px 9px;}
  #mode-btn{padding:6px 9px;}
}
</style>
</head>
<body>

<!-- BG ORBS -->
<div class="orb orb-1"></div>
<div class="orb orb-2"></div>
<div class="orb orb-3"></div>
<div id="mouse-glow"></div>

<!-- SIDEBAR OVERLAY -->
<div id="sb-overlay"></div>

<!-- ============================================================
     SIDEBAR
     ============================================================ -->
<div id="sidebar">
  <div class="sb-head">
    <div class="sb-title">‚ö° Open Z Menu</div>
    <button class="sb-close rip" id="sb-close-btn">‚úï</button>
  </div>

  <!-- Main menu items -->
  <div class="sb-menu">
    <div class="sb-item rip" id="sb-new-chat">
      <span class="sb-ic">‚ú¶</span> New Chat
    </div>
    <div class="sb-item rip" id="sb-export-pdf">
      <span class="sb-ic">üìÑ</span> Export Chat as PDF
    </div>
    <div class="sb-item danger rip" id="sb-clear-chat">
      <span class="sb-ic">üóëÔ∏è</span> Clear Chat
    </div>
    <div class="sb-item rip" id="sb-contact">
      <span class="sb-ic">‚úâÔ∏è</span> Contact Owner
    </div>
  </div>

  <!-- Chat history -->
  <div class="sb-section-label">Chat History</div>
  <div id="history-list">
    <div style="font-size:0.7rem;color:var(--tx3);font-family:'JetBrains Mono',monospace;padding:10px 12px;opacity:0.7;">
      No history yet...
    </div>
  </div>

  <!-- Font selector -->
  <div class="sb-fonts">
    <div class="sb-section-label" style="padding:0 0 8px;">Font Style</div>
    <div class="font-combo-row">
      <div class="font-chip active rip" data-font="chakra" style="font-family:'Chakra Petch',sans-serif;">Chakra</div>
      <div class="font-chip rip"        data-font="michroma" style="font-family:'Michroma',sans-serif;">Michroma</div>
      <div class="font-chip rip"        data-font="kanit" style="font-family:'Kanit',sans-serif;">Kanit</div>
    </div>
  </div>
</div>

<!-- ============================================================
     MAIN APP
     ============================================================ -->
<div id="app">

  <!-- HEADER -->
  <header id="header">
    <div style="display:flex;align-items:center;gap:10px;">
      <!-- Hamburger -->
      <button id="sb-toggle" class="rip" title="Menu">‚ò∞</button>
      <!-- Logo -->
      <a id="logo-wrap" href="#">
        <svg id="logo-svg" viewBox="0 0 46 46" fill="none" style="width:42px;height:42px;animation:logoPulse 3s ease-in-out infinite;">
          <g style="transform-origin:23px 23px;animation:ringCW 14s linear infinite;">
            <circle cx="23" cy="23" r="21" stroke="url(#h1)" stroke-width="1.2" stroke-dasharray="5 2.5" opacity="0.65"/>
          </g>
          <g style="transform-origin:23px 23px;animation:ringCCW 9s linear infinite;">
            <circle cx="23" cy="23" r="16.5" stroke="url(#h2)" stroke-width="0.7" stroke-dasharray="3 4" opacity="0.4"/>
          </g>
          <circle cx="23" cy="23" r="12" fill="url(#hc)" opacity="0.16"/>
          <path d="M13.5 15H32.5L13.5 31H32.5" stroke="url(#hz)" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
          <circle cx="13.5" cy="15" r="1.8" fill="url(#hd)"><animate attributeName="opacity" values="1;0.2;1" dur="2.1s" repeatCount="indefinite"/></circle>
          <circle cx="32.5" cy="15" r="1.8" fill="url(#hd)"><animate attributeName="opacity" values="0.2;1;0.2" dur="2.1s" repeatCount="indefinite"/></circle>
          <circle cx="13.5" cy="31" r="1.8" fill="url(#hd)"><animate attributeName="opacity" values="0.7;1;0.7" dur="2.6s" repeatCount="indefinite"/></circle>
          <circle cx="32.5" cy="31" r="1.8" fill="url(#hd)"><animate attributeName="opacity" values="1;0.3;1" dur="1.9s" repeatCount="indefinite"/></circle>
          <defs>
            <linearGradient id="h1" x1="0" y1="0" x2="46" y2="46" gradientUnits="userSpaceOnUse"><stop offset="0%" stop-color="var(--a1)"/><stop offset="100%" stop-color="var(--a3)"/></linearGradient>
            <linearGradient id="h2" x1="46" y1="0" x2="0" y2="46" gradientUnits="userSpaceOnUse"><stop offset="0%" stop-color="var(--a2)"/><stop offset="100%" stop-color="var(--a1)"/></linearGradient>
            <radialGradient id="hc" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="var(--a1)"/><stop offset="100%" stop-color="transparent"/></radialGradient>
            <linearGradient id="hz" x1="13" y1="15" x2="33" y2="31" gradientUnits="userSpaceOnUse"><stop offset="0%" stop-color="var(--a1)"/><stop offset="100%" stop-color="var(--a3)"/></linearGradient>
            <radialGradient id="hd" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="var(--a3)"/><stop offset="100%" stop-color="var(--a1)"/></radialGradient>
          </defs>
        </svg>
        <div>
          <div id="logo-text">Open Z</div>
          <div id="logo-sub">Neural Intelligence</div>
        </div>
      </a>
    </div>

    <div id="hdr-right">
      <!-- Model selector -->
      <div id="model-wrap">
        <button id="model-btn" class="rip">
          <span>‚ö°</span>
          <span class="model-label" id="model-lbl">llama-3.3-70b</span>
          <span class="chev">‚ñº</span>
        </button>
        <div id="model-dd">
          <div class="model-group-label">‚ö° FAST MODELS</div>
          <div class="mdi active" data-model="llama-3.3-70b-versatile">
            <span>llama-3.3-70b</span><span class="mdi-badge fast">FAST</span>
          </div>
          <div class="mdi" data-model="llama-3.1-8b-instant">
            <span>llama-3.1-8b</span><span class="mdi-badge fast">FASTEST</span>
          </div>
          <div class="mdi" data-model="gemma2-9b-it">
            <span>Gemma 2 9B</span><span class="mdi-badge fast">FAST</span>
          </div>
          <div class="model-group-label">üß† SMART MODELS</div>
          <div class="mdi" data-model="llama-3.1-70b-versatile">
            <span>llama-3.1-70b</span><span class="mdi-badge smart">SMART</span>
          </div>
          <div class="mdi" data-model="mixtral-8x7b-32768">
            <span>Mixtral 8x7B</span><span class="mdi-badge smart">SMART</span>
          </div>
          <div class="mdi" data-model="llama-3.2-90b-vision-preview">
            <span>llama-3.2-90b</span><span class="mdi-badge smart">SMART</span>
          </div>
          <div class="model-group-label">üî• POWER MODELS</div>
          <div class="mdi" data-model="llama3-70b-8192">
            <span>llama3-70b</span><span class="mdi-badge beast">POWER</span>
          </div>
          <div class="mdi" data-model="llama-3.2-11b-vision-preview">
            <span>llama-3.2-11b</span><span class="mdi-badge beast">VISION</span>
          </div>
        </div>
      </div>

      <!-- Mode selector -->
      <div id="mode-wrap">
        <button id="mode-btn" class="rip">
          <span id="mode-ic">ü§ñ</span>
          <span class="mode-label" id="mode-lbl">Default AI</span>
          <span class="chev2">‚ñº</span>
        </button>
        <div id="mode-dd">
          <div class="mdei active" data-mode="default">  <span class="mdei-ic">ü§ñ</span>Default AI</div>
          <div class="mdei" data-mode="study">    <span class="mdei-ic">üìö</span>Study Mode</div>
          <div class="mdei" data-mode="savage">   <span class="mdei-ic">üî•</span>Savage Mode</div>
          <div class="mdei" data-mode="gym">      <span class="mdei-ic">üí™</span>Gym Coach</div>
          <div class="mdei" data-mode="business"> <span class="mdei-ic">üíº</span>Business Advisor</div>
          <div class="mdei" data-mode="relation"> <span class="mdei-ic">üíï</span>Relationship Advisor</div>
          <div class="mdei" data-mode="coding">   <span class="mdei-ic">‚å®Ô∏è</span>Coding Assistant</div>
          <div class="mdei" data-mode="creative"> <span class="mdei-ic">‚ú®</span>Creative Writer</div>
        </div>
      </div>
    </div>
  </header>

  <!-- FLOATING THEME SWITCHER -->
  <div id="theme-panel">
    <button id="theme-toggle" class="rip" title="Themes">üé®</button>
    <div class="swatch active" data-t="neon-purple"   title="Neon Purple"></div>
    <div class="swatch"        data-t="electric-blue" title="Electric Blue"></div>
    <div class="swatch"        data-t="cyber-green"   title="Cyber Green"></div>
    <div class="swatch"        data-t="crimson-red"   title="Crimson Red"></div>
    <div class="swatch"        data-t="sunset-orange" title="Sunset Orange"></div>
    <div class="swatch"        data-t="royal-gold"    title="Royal Gold"></div>
    <div class="swatch"        data-t="midnight-cyan" title="Midnight Cyan"></div>
    <div class="swatch"        data-t="soft-pink"     title="Soft Pink Glow"></div>
  </div>

  <!-- CHAT AREA -->
  <div id="chat-area">
    <!-- Welcome screen -->
    <div id="welcome">
      <svg id="welcome-logo-svg" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
        <g style="transform-origin:50px 50px;animation:ringCW 18s linear infinite;">
          <circle cx="50" cy="50" r="46" stroke="url(#w1)" stroke-width="1.5" stroke-dasharray="7 3" opacity="0.6"/>
        </g>
        <g style="transform-origin:50px 50px;animation:ringCCW 11s linear infinite;">
          <circle cx="50" cy="50" r="37" stroke="url(#w2)" stroke-width="1" stroke-dasharray="4 6" opacity="0.38"/>
        </g>
        <circle cx="50" cy="50" r="26" fill="url(#wc)" opacity="0.18">
          <animate attributeName="opacity" values="0.1;0.28;0.1" dur="3.5s" repeatCount="indefinite"/>
        </circle>
        <path d="M29 32H71L29 68H71" stroke="url(#wz)" stroke-width="6" stroke-linecap="round" stroke-linejoin="round"/>
        <circle cx="29" cy="32" r="3.5" fill="url(#wd)"><animate attributeName="opacity" values="1;0.2;1" dur="2s" repeatCount="indefinite"/></circle>
        <circle cx="71" cy="32" r="3.5" fill="url(#wd)"><animate attributeName="opacity" values="0.2;1;0.2" dur="2s" repeatCount="indefinite"/></circle>
        <circle cx="29" cy="68" r="3.5" fill="url(#wd)"><animate attributeName="opacity" values="0.6;1;0.6" dur="3s" repeatCount="indefinite"/></circle>
        <circle cx="71" cy="68" r="3.5" fill="url(#wd)"><animate attributeName="opacity" values="1;0.4;1" dur="1.8s" repeatCount="indefinite"/></circle>
        <defs>
          <linearGradient id="w1" x1="0" y1="0" x2="100" y2="100" gradientUnits="userSpaceOnUse"><stop offset="0%" stop-color="var(--a1)"/><stop offset="100%" stop-color="var(--a3)"/></linearGradient>
          <linearGradient id="w2" x1="100" y1="0" x2="0" y2="100" gradientUnits="userSpaceOnUse"><stop offset="0%" stop-color="var(--a2)"/><stop offset="100%" stop-color="var(--a1)"/></linearGradient>
          <radialGradient id="wc" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="var(--a1)"/><stop offset="100%" stop-color="transparent"/></radialGradient>
          <linearGradient id="wz" x1="29" y1="32" x2="71" y2="68" gradientUnits="userSpaceOnUse"><stop offset="0%" stop-color="var(--a1)"/><stop offset="100%" stop-color="var(--a3)"/></linearGradient>
          <radialGradient id="wd" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="var(--a3)"/><stop offset="100%" stop-color="var(--a1)"/></radialGradient>
        </defs>
      </svg>
      <h1 id="wtitle"></h1>
      <p id="wsub">Your AI companion ‚Äî built for curiosity,<br>designed for results. Choose a mode and begin.</p>
      <div id="wpills">
        <span class="wpill">ü§ñ 8 AI Modes</span>
        <span class="wpill">‚ö° 8 AI Models</span>
        <span class="wpill">üé® 8 Themes</span>
        <span class="wpill">üîí Private</span>
        <span class="wpill">üíæ History</span>
      </div>
    </div>

    <!-- Typing indicator -->
    <div id="typing-row">
      <div class="ava ai">Z</div>
      <div class="typing-bub">
        <div class="dot"></div><div class="dot"></div><div class="dot"></div>
      </div>
    </div>
  </div>

  <!-- INPUT BAR -->
  <div id="input-area">
    <div id="input-wrap" class="rip">
      <textarea id="chat-input" placeholder="Ask Open Z anything‚Ä¶" rows="1"></textarea>
      <button id="send-btn" class="rip">
        <span class="send-ic">‚û§</span>
        <div class="spin-ic"></div>
      </button>
    </div>
  </div>

  <!-- FOOTER -->
  <footer id="footer">
    <span>Developed by</span>
    <a id="tg-link" href="https://t.me/zade4everbot" target="_blank" rel="noopener">
      <span class="tg-logo">‚úà</span>
      @zade4everbot
    </a>
  </footer>

</div><!-- end #app -->

<script>
/* ============================================================
   OPEN Z ‚Äî COMPLETE SCRIPT
   1. Config
   2. Modes
   3. State
   4. Sidebar
   5. Theme System
   6. Font System
   7. Model Selector
   8. Mode Selector
   9. Chat History (localStorage)
   10. Message Rendering
   11. Send Message / Groq API
   12. PDF Export
   13. Events
   14. Ripple
   15. Mouse Glow
   16. Hero Typing Effect
   17. Init
   ============================================================ */

/* ============================================================
   1. CONFIG
   ============================================================ */
const GROQ_KEY = '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';
const GROQ_URL = 'https://api.groq.com/openai/v1/chat/completions';

/* ============================================================
   2. AI MODES ‚Äî unique personality per mode
   ============================================================ */
const MODES = {
  default:  { icon:'ü§ñ', label:'Default AI',          temp:0.72, system:'You are Open Z, a highly intelligent and friendly AI assistant. Be helpful, accurate, and concise. Use markdown formatting where it improves clarity.' },
  study:    { icon:'üìö', label:'Study Mode',           temp:0.60, system:'You are Open Z in Study Mode ‚Äî a patient academic tutor. Break complex topics into clear numbered steps. Use analogies, real examples, and a brief summary at the end. Encourage the learner.' },
  savage:   { icon:'üî•', label:'Savage Mode',          temp:0.88, system:'You are Open Z in Savage Mode. Brutally honest, zero tolerance for mediocrity. Raw unfiltered truth with sharp wit. No sugarcoating. Roast bad ideas. But always answer accurately ‚Äî just ruthlessly.' },
  gym:      { icon:'üí™', label:'Gym Coach',            temp:0.70, system:'You are Open Z, an elite gym coach and sports nutritionist. Give structured workout plans (sets √ó reps), precise nutrition advice, and recovery science. Be intense, motivating, and safe.' },
  business: { icon:'üíº', label:'Business Advisor',     temp:0.68, system:'You are Open Z, a senior business strategist with startup and Fortune 500 experience. Give sharp, actionable advice on strategy, growth, and finance. Be concise and data-driven.' },
  relation: { icon:'üíï', label:'Relationship Advisor', temp:0.75, system:'You are Open Z, a compassionate relationship counselor. Offer empathetic, non-judgmental advice on relationships, communication, and personal growth. Be warm and practically helpful.' },
  coding:   { icon:'‚å®Ô∏è', label:'Coding Assistant',    temp:0.25, system:'You are Open Z, a senior software engineer. Provide clean, optimized, well-commented code. Always use proper markdown code blocks with language specified. Cover edge cases and best practices.' },
  creative: { icon:'‚ú®', label:'Creative Writer',      temp:0.92, system:'You are Open Z in Creative Writer mode ‚Äî an imaginative literary genius. Write vivid, emotionally resonant stories, poems, and scripts. Use rich metaphors and distinctive voice. Push creative limits.' }
};

/* ============================================================
   3. STATE
   ============================================================ */
let chatHistory  = [];   // API conversation history
let sessions     = [];   // saved sessions list
let activeMode   = 'default';
let activeModel  = 'llama-3.3-70b-versatile';
let activeFont   = 'chakra';
let isLoading    = false;
let themeOpen    = false;
let sidebarOpen  = false;
let sessionId    = Date.now(); // current session ID

/* ============================================================
   4. SIDEBAR
   ============================================================ */
const sidebar   = document.getElementById('sidebar');
const sbOverlay = document.getElementById('sb-overlay');

function openSidebar() {
  sidebarOpen = true;
  sidebar.classList.add('open');
  sbOverlay.classList.add('show');
  const app = document.getElementById('app');
  if (window.innerWidth > 640) app.classList.add('sb-open');
}
function closeSidebar() {
  sidebarOpen = false;
  sidebar.classList.remove('open');
  sbOverlay.classList.remove('show');
  document.getElementById('app').classList.remove('sb-open');
}

document.getElementById('sb-toggle').addEventListener('click', () => {
  sidebarOpen ? closeSidebar() : openSidebar();
});
document.getElementById('sb-close-btn').addEventListener('click', closeSidebar);
sbOverlay.addEventListener('click', closeSidebar);

/* ============================================================
   5. THEME SYSTEM
   ============================================================ */
function applyTheme(t) {
  document.documentElement.setAttribute('data-theme', t);
  document.querySelectorAll('.swatch').forEach(s =>
    s.classList.toggle('active', s.dataset.t === t)
  );
  localStorage.setItem('openz-theme', t);
}

document.getElementById('theme-toggle').addEventListener('click', () => {
  themeOpen = !themeOpen;
  document.querySelectorAll('.swatch').forEach(s => s.classList.toggle('vis', themeOpen));
  document.getElementById('theme-toggle').style.transform = themeOpen ? 'rotate(180deg)' : '';
});
document.querySelectorAll('.swatch').forEach(s =>
  s.addEventListener('click', () => applyTheme(s.dataset.t))
);

/* ============================================================
   6. FONT SYSTEM
   ============================================================ */
function applyFont(f) {
  activeFont = f;
  document.documentElement.setAttribute('data-font', f);
  document.querySelectorAll('.font-chip').forEach(c =>
    c.classList.toggle('active', c.dataset.font === f)
  );
  localStorage.setItem('openz-font', f);
}
document.querySelectorAll('.font-chip').forEach(c =>
  c.addEventListener('click', () => applyFont(c.dataset.font))
);

/* ============================================================
   7. MODEL SELECTOR
   ============================================================ */
const modelBtn = document.getElementById('model-btn');
const modelDD  = document.getElementById('model-dd');

modelBtn.addEventListener('click', e => {
  e.stopPropagation();
  const open = modelDD.classList.toggle('open');
  modelBtn.classList.toggle('open', open);
  // close mode dd
  document.getElementById('mode-dd').classList.remove('open');
  document.getElementById('mode-btn').classList.remove('open');
});

document.querySelectorAll('.mdi').forEach(el => {
  el.addEventListener('click', () => {
    activeModel = el.dataset.model;
    document.getElementById('model-lbl').textContent = el.querySelector('span:first-child').textContent;
    document.querySelectorAll('.mdi').forEach(i => i.classList.remove('active'));
    el.classList.add('active');
    modelDD.classList.remove('open');
    modelBtn.classList.remove('open');
    localStorage.setItem('openz-model', activeModel);
  });
});

/* ============================================================
   8. MODE SELECTOR
   ============================================================ */
const modeBtn = document.getElementById('mode-btn');
const modeDD  = document.getElementById('mode-dd');

function setMode(m) {
  activeMode = m;
  const cfg = MODES[m];
  document.getElementById('mode-ic').textContent  = cfg.icon;
  document.getElementById('mode-lbl').textContent = cfg.label;
  document.querySelectorAll('.mdei').forEach(i => i.classList.toggle('active', i.dataset.mode === m));
  modeDD.classList.remove('open');
  modeBtn.classList.remove('open');
  localStorage.setItem('openz-mode', m);
}

modeBtn.addEventListener('click', e => {
  e.stopPropagation();
  const open = modeDD.classList.toggle('open');
  modeBtn.classList.toggle('open', open);
  modelDD.classList.remove('open');
  modelBtn.classList.remove('open');
});
document.querySelectorAll('.mdei').forEach(el =>
  el.addEventListener('click', () => setMode(el.dataset.mode))
);

// Close all dropdowns on outside click
document.addEventListener('click', () => {
  modeDD.classList.remove('open');
  modeBtn.classList.remove('open');
  modelDD.classList.remove('open');
  modelBtn.classList.remove('open');
});

/* ============================================================
   9. CHAT HISTORY & SESSIONS (localStorage)
   ============================================================ */
function saveCurrentSession() {
  if (!chatHistory.length) return;
  const preview = chatHistory[0]?.content?.slice(0, 50) || 'Chat';
  const sess = { id: sessionId, preview, history: chatHistory, ts: Date.now() };
  const idx = sessions.findIndex(s => s.id === sessionId);
  if (idx >= 0) sessions[idx] = sess;
  else sessions.unshift(sess);
  if (sessions.length > 30) sessions.pop(); // max 30 sessions
  localStorage.setItem('openz-sessions', JSON.stringify(sessions));
  renderHistoryList();
}

function loadSessions() {
  try {
    const raw = localStorage.getItem('openz-sessions');
    if (raw) sessions = JSON.parse(raw);
  } catch(e) { sessions = []; }
  renderHistoryList();
}

function renderHistoryList() {
  const list = document.getElementById('history-list');
  if (!sessions.length) {
    list.innerHTML = `<div style="font-size:0.7rem;color:var(--tx3);font-family:'JetBrains Mono',monospace;padding:10px 12px;opacity:0.7;">No history yet...</div>`;
    return;
  }
  list.innerHTML = sessions.map(s => `
    <div class="hist-item rip ${s.id === sessionId ? 'active' : ''}" data-sid="${s.id}">
      ${escHtml(s.preview)}‚Ä¶
    </div>
  `).join('');
  list.querySelectorAll('.hist-item').forEach(el => {
    el.addEventListener('click', () => loadSession(parseInt(el.dataset.sid)));
  });
}

function loadSession(sid) {
  const sess = sessions.find(s => s.id === sid);
  if (!sess) return;
  sessionId = sess.id;
  chatHistory = sess.history;
  // Clear & re-render messages
  const chatArea = document.getElementById('chat-area');
  chatArea.querySelectorAll('.msg-row').forEach(r => r.remove());
  const w = document.getElementById('welcome');
  if (!w.parentNode) chatArea.prepend(w);
  hideWelcome();
  chatHistory.forEach(m => {
    if (m.role === 'user') renderMsg('user', m.content, false);
    else if (m.role === 'assistant') renderMsg('ai', m.content, false);
  });
  renderHistoryList();
  closeSidebar();
}

/* ============================================================
   10. MESSAGE RENDERING
   ============================================================ */
const chatArea  = document.getElementById('chat-area');
const welcomeEl = document.getElementById('welcome');
const typingRow = document.getElementById('typing-row');

function hideWelcome() {
  if (welcomeEl.parentNode === chatArea) chatArea.removeChild(welcomeEl);
}
function scrollBottom() { chatArea.scrollTop = chatArea.scrollHeight; }
function showTyping() { chatArea.appendChild(typingRow); typingRow.classList.add('show'); scrollBottom(); }
function hideTyping()  { typingRow.classList.remove('show'); }

function renderMsg(role, content, animate = true) {
  const isUser = role === 'user';
  const row = document.createElement('div');
  row.className = `msg-row ${isUser ? 'user' : 'ai'}`;

  const av = document.createElement('div');
  av.className = `ava ${isUser ? 'usr' : 'ai'}`;
  av.textContent = isUser ? 'üë§' : 'Z';

  const bub = document.createElement('div');
  bub.className = `bub ${isUser ? 'usr' : 'ai'}`;
  bub.innerHTML = formatMsg(content);

  if (!isUser) {
    const acts = document.createElement('div');
    acts.className = 'bub-acts';
    // Copy button
    const copyBtn = document.createElement('button');
    copyBtn.className = 'act-btn rip';
    copyBtn.innerHTML = 'üìã Copy';
    copyBtn.addEventListener('click', () => {
      navigator.clipboard.writeText(content).then(() => {
        copyBtn.innerHTML = '‚úÖ Copied!';
        setTimeout(() => copyBtn.innerHTML = 'üìã Copy', 2000);
      }).catch(() => {
        const ta = document.createElement('textarea');
        ta.value = content; document.body.appendChild(ta);
        ta.select(); document.execCommand('copy');
        document.body.removeChild(ta);
        copyBtn.innerHTML = '‚úÖ Copied!';
        setTimeout(() => copyBtn.innerHTML = 'üìã Copy', 2000);
      });
    });
    acts.appendChild(copyBtn);
    bub.appendChild(acts);
  }

  row.appendChild(av); row.appendChild(bub);
  chatArea.insertBefore(row, typingRow.classList.contains('show') ? typingRow : null);
  scrollBottom();
}

function formatMsg(t) {
  return t
    .replace(/```(\w+)?\n?([\s\S]*?)```/g, (_,l,c) => `<pre><code>${escHtml(c.trim())}</code></pre>`)
    .replace(/`([^`]+)`/g, '<code>$1</code>')
    .replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>')
    .replace(/\*([^*\n]+)\*/g, '<em>$1</em>')
    .replace(/\n/g, '<br>');
}

function escHtml(s) {
  return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}

/* ============================================================
   11. SEND MESSAGE ‚Äî GROQ API
   ============================================================ */
async function sendMessage() {
  const input = document.getElementById('chat-input');
  const text  = input.value.trim();
  if (!text || isLoading) return;

  isLoading = true;
  input.value = ''; input.style.height = 'auto';
  const btn = document.getElementById('send-btn');
  btn.disabled = true; btn.classList.add('loading');

  hideWelcome();
  renderMsg('user', text);
  showTyping();

  const messages = [
    { role:'system', content: MODES[activeMode].system },
    ...chatHistory.slice(-20),
    { role:'user', content: text }
  ];

  try {
    const res = await fetch(GROQ_URL, {
      method:'POST',
      headers:{
        'Authorization':`Bearer ${GROQ_KEY}`,
        'Content-Type':'application/json'
      },
      body:JSON.stringify({
        model: activeModel,
        messages,
        temperature: MODES[activeMode].temp,
        max_tokens: 1500
      })
    });

    const data = await res.json();
    if (!res.ok) throw new Error(data.error?.message || `Error ${res.status}`);

    const reply = data.choices[0].message.content;
    hideTyping();
    chatHistory.push({role:'user',content:text},{role:'assistant',content:reply});
    renderMsg('ai', reply);
    saveCurrentSession();

  } catch(err) {
    hideTyping();
    renderMsg('ai', `‚ö†Ô∏è **Error:** ${err.message}\n\n**Fix:** Host this file on **netlify.com/drop** ‚Äî the AI works perfectly when served online.`);
  } finally {
    isLoading = false;
    btn.disabled = false; btn.classList.remove('loading');
    input.focus();
  }
}

/* ============================================================
   12. PDF EXPORT
   ============================================================ */
function exportToPDF() {
  if (!chatHistory.length) {
    alert('No chat to export yet! Start a conversation first.');
    return;
  }
  // Build print-friendly HTML
  const rows = chatHistory.map(m => {
    const isUser = m.role === 'user';
    return `
      <div style="margin-bottom:16px;display:flex;justify-content:${isUser?'flex-end':'flex-start'};">
        <div style="
          max-width:70%;padding:12px 16px;border-radius:14px;
          background:${isUser?'#7c3aed':'#1a0035'};
          color:${isUser?'#fff':'#f0e6ff'};
          font-size:13px;line-height:1.7;
          border:1px solid ${isUser?'#b347ff':'#3a1560'};
        ">
          <div style="font-size:10px;opacity:0.6;margin-bottom:6px;font-weight:700;letter-spacing:1px;">
            ${isUser ? 'üë§ YOU' : 'Z OPEN Z'}
          </div>
          ${m.content.replace(/\n/g,'<br>').replace(/\*\*([^*]+)\*\*/g,'<strong>$1</strong>')}
        </div>
      </div>
    `;
  }).join('');

  const win = window.open('', '_blank');
  win.document.write(`
    <!DOCTYPE html><html><head>
    <meta charset="UTF-8">
    <title>Open Z ‚Äî Chat Export</title>
    <style>
      * { margin:0; padding:0; box-sizing:border-box; }
      body {
        background: #06000f; color: #f0e6ff;
        font-family: 'Segoe UI', sans-serif;
        padding: 40px;
      }
      .header {
        text-align:center; margin-bottom:40px;
        padding-bottom:20px; border-bottom:2px solid #3a1560;
      }
      .header h1 {
        font-size:28px; font-weight:900;
        letter-spacing:4px; text-transform:uppercase;
        background:linear-gradient(135deg,#b347ff,#e040fb);
        -webkit-background-clip:text; -webkit-text-fill-color:transparent;
      }
      .header p { font-size:11px; color:#8a6aaa; margin-top:6px; letter-spacing:2px; }
      .footer {
        text-align:center; margin-top:40px;
        padding-top:20px; border-top:1px solid #3a1560;
        font-size:10px; color:#8a6aaa; letter-spacing:2px;
      }
      @media print { body { -webkit-print-color-adjust:exact; print-color-adjust:exact; } }
    </style>
    </head><body>
    <div class="header">
      <h1>‚ö° Open Z</h1>
      <p>CHAT EXPORT ¬∑ ${new Date().toLocaleDateString('en-US',{weekday:'long',year:'numeric',month:'long',day:'numeric'})}</p>
      <p style="margin-top:4px;">MODE: ${MODES[activeMode].label.toUpperCase()} ¬∑ MODEL: ${activeModel.toUpperCase()}</p>
    </div>
    ${rows}
    <div class="footer">
      DEVELOPED BY @zade4everbot ¬∑ OPEN Z NEURAL INTELLIGENCE
    </div>
    </body></html>
  `);
  win.document.close();
  setTimeout(() => { win.focus(); win.print(); }, 500);
}

/* ============================================================
   13. SIDEBAR ACTION EVENTS
   ============================================================ */
// New chat
document.getElementById('sb-new-chat').addEventListener('click', () => {
  saveCurrentSession(); // save current before clearing
  sessionId   = Date.now();
  chatHistory = [];
  chatArea.querySelectorAll('.msg-row').forEach(r => r.remove());
  if (!welcomeEl.parentNode) chatArea.prepend(welcomeEl);
  renderHistoryList();
  closeSidebar();
});

// Export PDF
document.getElementById('sb-export-pdf').addEventListener('click', () => {
  exportToPDF();
  closeSidebar();
});

// Clear chat
document.getElementById('sb-clear-chat').addEventListener('click', () => {
  if (!chatHistory.length) { closeSidebar(); return; }
  if (!confirm('Clear current chat? This cannot be undone.')) return;
  chatHistory = [];
  sessionId   = Date.now();
  chatArea.querySelectorAll('.msg-row').forEach(r => r.remove());
  if (!welcomeEl.parentNode) chatArea.prepend(welcomeEl);
  localStorage.removeItem('openz-sessions');
  sessions = [];
  renderHistoryList();
  closeSidebar();
});

// Contact owner
document.getElementById('sb-contact').addEventListener('click', () => {
  window.open('https://t.me/zade4everbot', '_blank', 'noopener');
  closeSidebar();
});

/* ============================================================
   14. INPUT EVENTS
   ============================================================ */
document.getElementById('chat-input').addEventListener('keydown', e => {
  if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMessage(); }
});
document.getElementById('chat-input').addEventListener('input', function() {
  this.style.height = 'auto';
  this.style.height = Math.min(this.scrollHeight, 130) + 'px';
});
document.getElementById('send-btn').addEventListener('click', sendMessage);

/* ============================================================
   15. RIPPLE EFFECT
   ============================================================ */
document.addEventListener('click', e => {
  const t = e.target.closest('.rip');
  if (!t) return;
  const r = t.getBoundingClientRect();
  const size = Math.max(r.width, r.height);
  const rip = document.createElement('span');
  rip.className = 'rip-el';
  rip.style.cssText = `width:${size}px;height:${size}px;left:${e.clientX-r.left-size/2}px;top:${e.clientY-r.top-size/2}px;`;
  t.appendChild(rip);
  setTimeout(() => rip.remove(), 700);
});

/* ============================================================
   16. MOUSE GLOW
   ============================================================ */
document.addEventListener('mousemove', e => {
  const mg = document.getElementById('mouse-glow');
  mg.style.left = e.clientX + 'px';
  mg.style.top  = e.clientY + 'px';
});

/* ============================================================
   17. HERO TYPING EFFECT
   ============================================================ */
(function() {
  const el = document.getElementById('wtitle');
  if (!el) return;
  const lines = ['Intelligence Redefined.','Your AI Companion.','Think Beyond Limits.','Power. Precision. AI.'];
  let li=0, ci=0, del=false;
  function tick() {
    const cur = lines[li];
    el.textContent = del ? cur.slice(0,--ci) : cur.slice(0,++ci);
    if (!del && ci===cur.length){ del=true; return setTimeout(tick,2200); }
    if (del && ci===0){ del=false; li=(li+1)%lines.length; }
    setTimeout(tick, del?45:82);
  }
  setTimeout(tick, 700);
})();

/* ============================================================
   18. INIT ‚Äî restore saved preferences
   ============================================================ */
// Theme
applyTheme(localStorage.getItem('openz-theme') || 'neon-purple');

// Font
applyFont(localStorage.getItem('openz-font') || 'chakra');

// Mode
setMode(localStorage.getItem('openz-mode') || 'default');

// Model
const savedModel = localStorage.getItem('openz-model');
if (savedModel) {
  activeModel = savedModel;
  const mEl = document.querySelector(`.mdi[data-model="${savedModel}"]`);
  if (mEl) {
    document.querySelectorAll('.mdi').forEach(i => i.classList.remove('active'));
    mEl.classList.add('active');
    document.getElementById('model-lbl').textContent = mEl.querySelector('span:first-child').textContent;
  }
}

// Sessions / history
loadSessions();

// Focus input
document.getElementById('chat-input').focus();

</script>
</body>
</html>
